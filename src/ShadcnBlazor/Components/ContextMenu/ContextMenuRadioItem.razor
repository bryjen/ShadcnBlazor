@namespace ShadcnBlazor.Components.ContextMenu
@using Microsoft.AspNetCore.Components.Web
@inherits ShadcnBlazor.Components.Shared.ShadcnComponentBase

<button type="button"
        role="menuitemradio"
        aria-checked="@(IsChecked.ToString().ToLower())"
        aria-disabled="@Disabled.ToString().ToLower()"
        disabled="@Disabled"
        class="@MergeCss("relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0", Class)"
        @onclick="HandleClick"
        @attributes="AdditionalAttributes">
    <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
        @if (IsChecked)
        {
            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="currentColor" aria-hidden="true">
                <circle cx="4" cy="4" r="4" />
            </svg>
        }
    </span>
    @ChildContent
</button>

@code {
    [CascadingParameter]
    private ContextMenuRadioGroupContext? RadioGroupContext { get; set; }

    [CascadingParameter]
    private ContextMenuContext? Context { get; set; }

    [CascadingParameter]
    private ContextMenuSubContext? SubContext { get; set; }

    /// <summary>
    /// The radio item content.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// The value for this radio item.
    /// </summary>
    [Parameter]
    public string Value { get; set; } = string.Empty;

    /// <summary>
    /// When true, the item is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    private bool IsChecked => RadioGroupContext?.Value == Value;

    private async Task HandleClick(MouseEventArgs args)
    {
        if (Disabled)
            return;
        if (RadioGroupContext?.OnValueChanged is not null)
        {
            await RadioGroupContext.OnValueChanged(Value);
        }
        // Close the root context menu
        var rootContext = SubContext?.RootMenuContext ?? Context;
        if (rootContext?.Close is not null) await rootContext.Close();
    }
}
