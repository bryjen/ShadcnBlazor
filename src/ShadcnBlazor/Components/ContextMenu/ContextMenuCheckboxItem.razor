@namespace ShadcnBlazor.Components.ContextMenu
@using Microsoft.AspNetCore.Components.Web
@inherits ShadcnBlazor.Components.Shared.ShadcnComponentBase

<button type="button"
        role="menuitemcheckbox"
        aria-checked="@Checked.ToString().ToLower()"
        aria-disabled="@Disabled.ToString().ToLower()"
        disabled="@Disabled"
        class="@MergeCss("relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0", Class)"
        @onclick="HandleClick"
        @attributes="AdditionalAttributes">
    <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
        @if (Checked)
        {
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        }
    </span>
    @ChildContent
</button>

@code {
    [CascadingParameter]
    private ContextMenuContext? Context { get; set; }

    [CascadingParameter]
    private ContextMenuSubContext? SubContext { get; set; }

    /// <summary>
    /// The checkbox item content.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Whether the checkbox item is checked.
    /// </summary>
    [Parameter]
    public bool Checked { get; set; }

    /// <summary>
    /// Callback when the checked state changes.
    /// </summary>
    [Parameter]
    public EventCallback<bool> CheckedChanged { get; set; }

    /// <summary>
    /// When true, the item is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    private async Task HandleClick(MouseEventArgs args)
    {
        if (Disabled)
            return;
        await CheckedChanged.InvokeAsync(!Checked);
        var rootContext = SubContext?.RootMenuContext ?? Context;
        if (rootContext?.Close is not null) await rootContext.Close();
    }
}
