@namespace ShadcnBlazor.Components.ContextMenu
@using Microsoft.AspNetCore.Components.Web
@inherits ShadcnBlazor.Components.Shared.ShadcnComponentBase

<button type="button"
        role="menuitem"
        disabled="@Disabled"
        aria-disabled="@Disabled.ToString().ToLower()"
        class="@GetItemClass()"
        @onclick="HandleClick"
        @attributes="AdditionalAttributes">
    @ChildContent
</button>

@code {
    [CascadingParameter]
    private ContextMenuContext? Context { get; set; }

    [CascadingParameter]
    private ContextMenuSubContext? SubContext { get; set; }

    /// <summary>
    /// The menu item content.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// When true, the item is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// When true, styles the item as a destructive action.
    /// </summary>
    [Parameter]
    public bool Destructive { get; set; }

    /// <summary>
    /// Callback when the item is clicked.
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    private string GetItemClass()
    {
        var baseClass = "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0";
        if (Destructive)
            baseClass += " text-destructive focus:text-destructive";
        return MergeCss(baseClass, Class);
    }

    private async Task HandleClick(MouseEventArgs args)
    {
        if (Disabled)
            return;
        await OnClick.InvokeAsync(args);
        // Close the root context menu
        var rootContext = SubContext?.RootMenuContext ?? Context;
        if (rootContext?.Close is not null) await rootContext.Close();
    }
}
