@namespace ShadcnBlazor.Components.Accordion
@inherits ShadcnComponentBase

<button
    type="button"
    data-slot="accordion-trigger"
    data-state="@(IsOpen ? "open" : "closed")"
    data-disabled="@(Disabled ? "true" : "false")"
    disabled="@Disabled"
    class="@GetClass()"
    @onclick="OnClick">
    <span class="text-left">
        @ChildContent
    </span>
    <svg
        class="h-4 w-4 shrink-0 transition-transform duration-200 @(IsOpen ? "rotate-180" : "")"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
</button>

@code {
    [CascadingParameter]
    private AccordionItem.AccordionItemContext? ItemContext { get; set; }

    /// <summary>
    /// The content of the trigger, typically the heading text. Clicking toggles the associated content visibility.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private bool IsOpen => ItemContext?.IsOpen ?? false;

    private bool Disabled => ItemContext?.Disabled ?? false;

    private async Task OnClick()
    {
        if (ItemContext is null)
            throw new InvalidOperationException("AccordionTrigger must be used inside an AccordionItem.");

        if (Disabled)
            return;

        await ItemContext.ToggleAsync();
    }

    private string GetClass()
    {
        var baseClasses = "flex w-full items-center justify-between py-4 text-sm font-medium transition-all hover:underline";
        var disabledClasses = Disabled ? "pointer-events-none opacity-50" : "";
        return MergeCss(baseClasses, disabledClasses, Class);
    }
}
