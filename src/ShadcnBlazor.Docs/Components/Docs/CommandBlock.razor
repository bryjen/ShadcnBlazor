@using EasyAppDev.Blazor.Icons.Lucide

@inherits ShadcnComponentBase

<div class="@(MergeCss("w-full rounded-lg overflow-hidden border border-border", Class))">
    <div class="flex items-center justify-between p-2 border-b border-border">
        <div class="flex items-center gap-3">
            <span class="text-muted-foreground/70" aria-hidden="true">
                <LuTerminal class="size-3.5" />
            </span>
            @if (Options.Count > 0)
            {
                <div class="command-block-toggle-group inline-flex h-7 overflow-hidden rounded-md border border-input/70 bg-transparent"
                     role="group">
                    @foreach (var kvp in Options)
                    {
                        var key = kvp.Key;
                        var isSelected = SelectedKey == key;
                        <ToggleButton Size="@Size.Sm"
                                      VariantToggled="@Variant.Outline"
                                      VariantUntoggled="@Variant.Ghost"
                                      IsToggled="@isSelected"
                                      IsToggledChanged="@(toggled => { if (toggled) SelectOption(key); })"
                                      Class="px-2.5 py-0 text-xs font-medium"
                                      AdditionalAttributes="@(new Dictionary<string, object> { ["data-state"] = isSelected ? "on" : "off", ["data-option"] = key })">
                            <span class="font-bold">@key</span>
                        </ToggleButton>
                    }
                </div>
            }
        </div>
        <Button Size="@Size.Sm"
                Variant="@Variant.Ghost"
                Class="h-7 w-7 p-0 text-muted-foreground hover:text-foreground transition-colors duration-200"
                OnClick="CopyCommandAsync"
                title="@(_copied ? "Copied!" : "Copy command")">
            @if (_copied)
            {
                <LuCheck class="size-4 transition-colors duration-200 text-emerald-600" />
            }
            else
            {
                <LuCopy class="size-4 transition-colors duration-200" />
            }
        </Button>
    </div>
    @if (SelectedKey != null && Options.TryGetValue(SelectedKey, out var value))
    {
        <div class="p-2 text-sm overflow-x-auto bg-card font-['JetBrains_Mono']">
            @value
        </div>
    }
</div>
