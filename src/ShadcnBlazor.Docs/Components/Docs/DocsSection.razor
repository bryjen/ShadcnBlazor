@inherits ShadcnComponentBase

<CascadingValue Value="@SectionId" Name="TocSectionId">
<section class="@(MergeCss("docs-section w-full h-full flex flex-col gap-2 scroll-mt-20 mb-6 min-w-0", Class))" id="@SectionId">
    @if (!string.IsNullOrEmpty(Title))
    {
        <h2 class="text-2xl font-semibold text-foreground">@Title</h2>
    }
    
    <div class="text-[0.9rem] leading-relaxed text-foreground/85 min-w-0">
        @ChildContent
    </div>
</section>
</CascadingValue>

@inject ShadcnBlazor.Docs.Services.PageTocService TocService

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public string? Id { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    /// <summary>When false, this section is not added to the On This Page TOC. Use when the parent will add it later (e.g. API Reference).</summary>
    [Parameter] public bool AddToToc { get; set; } = true;

    private string SectionId => !string.IsNullOrEmpty(Id)
        ? Id
        : (!string.IsNullOrEmpty(Title) ? Title.ToLowerInvariant().Replace(" ", "-") : "");

    protected override void OnParametersSet()
    {
        if (AddToToc && !string.IsNullOrEmpty(Title) && !string.IsNullOrEmpty(SectionId))
            TocService.AddSection(Title, SectionId, 0);
    }
}
